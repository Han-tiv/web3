<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nitter API è¯Šæ–­å·¥å…·</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #2c3e50; text-align: center; margin-bottom: 30px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .test-section h3 { color: #34495e; margin-top: 0; }
        button { background: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #2980b9; }
        button:disabled { background: #95a5a6; cursor: not-allowed; }
        .result { margin: 10px 0; padding: 15px; border-radius: 5px; white-space: pre-wrap; font-family: monospace; }
        .success { background: #d5edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .loading { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        code { background: #f8f9fa; padding: 2px 6px; border-radius: 3px; }
        ul { text-align: left; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Nitter API è¯Šæ–­å·¥å…·</h1>

        <div class="test-section">
            <h3>ğŸ“‹ åŸºç¡€ä¿¡æ¯</h3>
            <div class="result info" id="browser-info">æ­£åœ¨è·å–æµè§ˆå™¨ä¿¡æ¯...</div>
        </div>

        <div class="test-section">
            <h3>ğŸŒ è¿æ¥æµ‹è¯•</h3>
            <button onclick="testConnection()">æµ‹è¯• API è¿æ¥</button>
            <button onclick="testAllEndpoints()">æµ‹è¯•æ‰€æœ‰ç«¯ç‚¹</button>
            <button onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
            <div id="connection-results"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ› ï¸ æ•…éšœæ’æŸ¥</h3>
            <button onclick="showTroubleshooting()">æ˜¾ç¤ºæ•…éšœæ’æŸ¥æŒ‡å—</button>
            <div id="troubleshooting" style="display: none;">
                <div class="result info">
                    <strong>å¦‚æœè¿æ¥å¤±è´¥ï¼Œè¯·å°è¯•ä»¥ä¸‹è§£å†³æ–¹æ¡ˆï¼š</strong>

                    <ul>
                        <li><strong>æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€ï¼š</strong>
                            <br>åœ¨ç»ˆç«¯è¿è¡Œ: <code>curl http://localhost:3001/health</code>
                        </li>

                        <li><strong>æ£€æŸ¥é˜²ç«å¢™è®¾ç½®ï¼š</strong>
                            <br>ç¡®ä¿ç«¯å£3001æ²¡æœ‰è¢«é˜²ç«å¢™é˜»æ­¢
                        </li>

                        <li><strong>å°è¯•ä¸åŒçš„åœ°å€ï¼š</strong>
                            <br>â€¢ http://127.0.0.1:3001/dashboard
                            <br>â€¢ http://[::1]:3001/dashboard
                        </li>

                        <li><strong>æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼š</strong>
                            <br>æŒ‰ Ctrl+Shift+R å¼ºåˆ¶åˆ·æ–°é¡µé¢
                        </li>

                        <li><strong>æ£€æŸ¥ä»£ç†è®¾ç½®ï¼š</strong>
                            <br>ç¡®ä¿æµè§ˆå™¨æ²¡æœ‰ä½¿ç”¨ä»£ç†æœåŠ¡å™¨
                        </li>

                        <li><strong>å°è¯•å…¶ä»–æµè§ˆå™¨ï¼š</strong>
                            <br>æµ‹è¯• Chromeã€Firefoxã€Safari ç­‰
                        </li>

                        <li><strong>æ£€æŸ¥æœåŠ¡å™¨è¿›ç¨‹ï¼š</strong>
                            <br>è¿è¡Œ: <code>ps aux | grep node | grep api</code>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š å®æ—¶ç›‘æ§</h3>
            <button onclick="startMonitoring()">å¼€å§‹ç›‘æ§</button>
            <button onclick="stopMonitoring()">åœæ­¢ç›‘æ§</button>
            <div id="monitoring-results"></div>
        </div>
    </div>

    <script>
        let monitoringInterval = null;

        // æ˜¾ç¤ºæµè§ˆå™¨ä¿¡æ¯
        function showBrowserInfo() {
            const info = {
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                language: navigator.language,
                cookieEnabled: navigator.cookieEnabled,
                onLine: navigator.onLine,
                url: window.location.href,
                timestamp: new Date().toLocaleString('zh-CN')
            };

            document.getElementById('browser-info').innerHTML =
                `<strong>æµè§ˆå™¨ä¿¡æ¯ï¼š</strong>\n` +
                `â€¢ ç”¨æˆ·ä»£ç†: ${info.userAgent}\n` +
                `â€¢ å¹³å°: ${info.platform}\n` +
                `â€¢ è¯­è¨€: ${info.language}\n` +
                `â€¢ Cookieå¯ç”¨: ${info.cookieEnabled}\n` +
                `â€¢ ç½‘ç»œçŠ¶æ€: ${info.onLine ? 'åœ¨çº¿' : 'ç¦»çº¿'}\n` +
                `â€¢ å½“å‰URL: ${info.url}\n` +
                `â€¢ æ—¶é—´: ${info.timestamp}`;
        }

        // æµ‹è¯•å•ä¸ªç«¯ç‚¹
        async function testEndpoint(url, description) {
            const resultDiv = document.getElementById('connection-results');
            const testId = `test-${Date.now()}`;

            // æ·»åŠ æµ‹è¯•å¼€å§‹çŠ¶æ€
            const testEl = document.createElement('div');
            testEl.id = testId;
            testEl.className = 'result loading';
            testEl.textContent = `ğŸ”„ æ­£åœ¨æµ‹è¯• ${description}...`;
            resultDiv.appendChild(testEl);

            try {
                const startTime = Date.now();
                const response = await fetch(url, {
                    method: 'GET',
                    mode: 'cors',
                    cache: 'no-cache',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });

                const responseTime = Date.now() - startTime;
                const data = await response.text();

                if (response.ok) {
                    testEl.className = 'result success';
                    testEl.innerHTML =
                        `âœ… ${description} - æˆåŠŸ\n` +
                        `â€¢ çŠ¶æ€: ${response.status} ${response.statusText}\n` +
                        `â€¢ å“åº”æ—¶é—´: ${responseTime}ms\n` +
                        `â€¢ æ•°æ®é•¿åº¦: ${data.length} å­—èŠ‚\n` +
                        `â€¢ å“åº”æ•°æ®: ${data.substring(0, 200)}${data.length > 200 ? '...' : ''}`;
                } else {
                    testEl.className = 'result error';
                    testEl.innerHTML =
                        `âŒ ${description} - HTTPé”™è¯¯\n` +
                        `â€¢ çŠ¶æ€: ${response.status} ${response.statusText}\n` +
                        `â€¢ å“åº”æ—¶é—´: ${responseTime}ms\n` +
                        `â€¢ é”™è¯¯ä¿¡æ¯: ${data}`;
                }
            } catch (error) {
                testEl.className = 'result error';
                testEl.innerHTML =
                    `âŒ ${description} - è¿æ¥å¤±è´¥\n` +
                    `â€¢ é”™è¯¯ç±»å‹: ${error.name}\n` +
                    `â€¢ é”™è¯¯ä¿¡æ¯: ${error.message}\n` +
                    `â€¢ å¯èƒ½åŸå› : æœåŠ¡å™¨æœªè¿è¡Œã€ç½‘ç»œé—®é¢˜ã€CORSç­–ç•¥ã€é˜²ç«å¢™é˜»æ­¢`;
            }

            return testEl;
        }

        // æµ‹è¯•åŸºæœ¬è¿æ¥
        async function testConnection() {
            await testEndpoint('http://localhost:3001/health', 'APIå¥åº·æ£€æŸ¥');
        }

        // æµ‹è¯•æ‰€æœ‰ç«¯ç‚¹
        async function testAllEndpoints() {
            const endpoints = [
                { url: 'http://localhost:3001/health', desc: 'APIå¥åº·æ£€æŸ¥' },
                { url: 'http://localhost:3001/stats', desc: 'è¿è¡Œç»Ÿè®¡' },
                { url: 'http://localhost:3001/filters', desc: 'è¿‡æ»¤å™¨é…ç½®' },
                { url: 'http://localhost:3001/opportunities', desc: 'æœ€æ–°æœºä¼š' },
                { url: 'http://localhost:3001/accounts', desc: 'ç›‘æ§è´¦æˆ·' },
                { url: 'http://localhost:3001/keywords', desc: 'å…³é”®è¯åˆ—è¡¨' }
            ];

            for (const endpoint of endpoints) {
                await testEndpoint(endpoint.url, endpoint.desc);
                // å°å»¶è¿Ÿé¿å…è¿‡å¿«è¯·æ±‚
                await new Promise(resolve => setTimeout(resolve, 100));
            }
        }

        // æ¸…é™¤ç»“æœ
        function clearResults() {
            document.getElementById('connection-results').innerHTML = '';
            document.getElementById('monitoring-results').innerHTML = '';
        }

        // æ˜¾ç¤ºæ•…éšœæ’æŸ¥
        function showTroubleshooting() {
            const troubleshootingDiv = document.getElementById('troubleshooting');
            troubleshootingDiv.style.display = troubleshootingDiv.style.display === 'none' ? 'block' : 'none';
        }

        // å¼€å§‹ç›‘æ§
        function startMonitoring() {
            if (monitoringInterval) return;

            const resultsDiv = document.getElementById('monitoring-results');
            resultsDiv.innerHTML = '<div class="result info">ğŸ“Š ç›‘æ§å·²å¯åŠ¨ï¼Œæ¯10ç§’æ£€æŸ¥ä¸€æ¬¡æœåŠ¡çŠ¶æ€...</div>';

            monitoringInterval = setInterval(async () => {
                const timestamp = new Date().toLocaleString('zh-CN');
                try {
                    const response = await fetch('http://localhost:3001/health');
                    const data = await response.json();

                    const monitorDiv = document.createElement('div');
                    monitorDiv.className = 'result success';
                    monitorDiv.innerHTML =
                        `[${timestamp}] âœ… æœåŠ¡æ­£å¸¸\n` +
                        `â€¢ è¿è¡Œæ—¶é—´: ${Math.round(data.uptime)}ç§’\n` +
                        `â€¢ ç‰ˆæœ¬: ${data.version}`;

                    resultsDiv.appendChild(monitorDiv);

                    // åªä¿ç•™æœ€è¿‘5æ¡è®°å½•
                    while (resultsDiv.children.length > 6) {
                        resultsDiv.removeChild(resultsDiv.children[1]);
                    }

                } catch (error) {
                    const monitorDiv = document.createElement('div');
                    monitorDiv.className = 'result error';
                    monitorDiv.innerHTML = `[${timestamp}] âŒ è¿æ¥å¤±è´¥: ${error.message}`;
                    resultsDiv.appendChild(monitorDiv);
                }

                resultsDiv.scrollTop = resultsDiv.scrollHeight;
            }, 10000);
        }

        // åœæ­¢ç›‘æ§
        function stopMonitoring() {
            if (monitoringInterval) {
                clearInterval(monitoringInterval);
                monitoringInterval = null;

                const resultsDiv = document.getElementById('monitoring-results');
                const stopDiv = document.createElement('div');
                stopDiv.className = 'result info';
                stopDiv.textContent = `[${new Date().toLocaleString('zh-CN')}] ğŸ“Š ç›‘æ§å·²åœæ­¢`;
                resultsDiv.appendChild(stopDiv);
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', () => {
            showBrowserInfo();
            // è‡ªåŠ¨æµ‹è¯•è¿æ¥
            setTimeout(testConnection, 1000);
        });
    </script>
</body>
</html>